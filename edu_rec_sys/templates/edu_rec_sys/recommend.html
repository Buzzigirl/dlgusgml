<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <title>AI ê³¼ëª© ì¶”ì²œ ì‹œìŠ¤í…œ</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            margin: 2em;
            line-height: 1.6;
            background-color: #f9f9f9;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background-color: white;
            padding: 2em;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        table {
            border-collapse: collapse;
            width: 100%;
            margin: 1.5em 0;
        }

        th,
        td {
            border: 1px solid #ddd;
            padding: 12px;
            text-align: left;
        }

        th {
            background-color: #f2f2f2;
            font-weight: 600;
        }

        .form-container,
        .results-container,
        .student-info-container,
        .filter-container {
            margin-bottom: 2em;
            padding: 1.5em;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
        }

        .filter-group {
            margin-bottom: 1.5em;
        }

        .filter-group strong {
            display: block;
            margin-bottom: 0.5em;
            color: #0056b3;
        }

        .filter-options {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        .filter-options label {
            display: inline-flex;
            align-items: center;
            padding: 6px 12px;
            border: 1px solid #ccc;
            border-radius: 4px;
            cursor: pointer;
            background-color: white;
            transition: all 0.2s;
        }

        .filter-options label:hover {
            background-color: #f0f0f0;
        }

        .filter-options input[type="checkbox"] {
            margin-right: 6px;
        }

        button {
            padding: 12px 20px;
            font-size: 1em;
            background-color: #28a745;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        button:hover {
            background-color: #218838;
        }

        button.secondary {
            background-color: #007bff;
        }

        button.secondary:hover {
            background-color: #0056b3;
        }

        h1,
        h2,
        h3 {
            color: #0056b3;
        }

        .error {
            color: red;
            font-weight: bold;
        }

        #filter-section {
            display: none;
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>ğŸ“ Path-Finding AI ê³¼ëª© ì¶”ì²œ ì‹œìŠ¤í…œ</h1>

        <div class="form-container">
            <form method="post">
                {% csrf_token %}
                <label for="student_id"><strong>í•™ìƒ IDë¥¼ ì…ë ¥í•˜ê³  ì¶”ì²œ ê²°ê³¼ ë³´ê¸°:</strong></label><br>
                <input type="text" id="student_id" name="student_id" value="{{ student_id|default:'' }}" required
                    style="padding: 8px; border: 1px solid #ccc; border-radius: 4px; margin-right: 10px;">
                <button type="submit">ëª¨ë¸ ì¶”ì²œ ë³´ê¸°</button>
                {% if error %}
                <p class="error">{{ error }}</p>
                {% endif %}
            </form>
        </div>

        {% if student_data %}
        <div class="student-info-container">
            <h2>ğŸ“ í•™ìƒ ì •ë³´ (ID: {{ student_id }})</h2>
            <ul>
                <li><strong>ë‹¨ê³¼ëŒ€í•™:</strong> {{ student_data.info.student_college_name }}</li>
                <li><strong>ì£¼ì „ê³µ:</strong> {{ student_data.info.student_major_name }}</li>
                <li><strong>ì„¸ë¶€ì „ê³µ:</strong> {{ student_data.info.student_major_detail|default:"(ì •ë³´ ì—†ìŒ)" }}</li>
                <li><strong>ì…í•™ë…„ì›”:</strong> {{ student_data.info.ì…í•™ë…„ì›” }}</li>
            </ul>

            <h3>ğŸ“œ ì „ì²´ ìˆ˜ê°• ì´ë ¥</h3>
            {% for term, courses in student_data.history %}
            <p><strong>{{ term }}:</strong> {{ courses|join:", " }}</p>
            {% empty %}
            <p>ìˆ˜ê°• ì´ë ¥ì´ ì—†ìŠµë‹ˆë‹¤.</p>
            {% endfor %}
        </div>
        {% endif %}

        {% if base_recommendations %}
        <div class="results-container">
            <h2>1ï¸âƒ£ ëª¨ë¸ ì¶”ì²œ Top {{ base_recommendations|length }}ê°œ ê³¼ëª©</h2>
            <p>AI ëª¨ë¸ì´ ì˜ˆì¸¡í•œ 2024ë…„ 1í•™ê¸° ì¶”ì²œ ê³¼ëª©ì…ë‹ˆë‹¤.</p>

            <table>
                <thead>
                    <tr>
                        <th>ê³¼ëª©ëª…</th>
                        <th>ê³¼ëª© ë²ˆí˜¸</th>
                        <th>ê³¼ëª© ë¶„ë¥˜</th>
                        <th>ê³¼ëª© ì„¸ë¶€ë¶„ë¥˜</th>
                        <th>ì¶”ì²œ ì ìˆ˜</th>
                    </tr>
                </thead>
                <tbody>
                    {% for course in base_recommendations %}
                    <tr>
                        <td>{{ course.SUBJT_NM }}</td>
                        <td>{{ course.SUBJTNB }}</td>
                        <td>{{ course.subject_category }}</td>
                        <td>{{ course.subject_div }}</td>
                        <td>{{ course.pred_score|floatformat:3 }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>

            <hr style="margin: 2em 0;">

            <button class="secondary"
                onclick="document.getElementById('filter-section').style.display='block'; this.style.display='none';">âš™ï¸
                í•„í„° ì˜µì…˜ í‘œì‹œ</button>

            <div id="filter-section">
                <h3>2ï¸âƒ£ ë‚˜ë§Œì˜ ë§ì¶¤ í•„í„° ì ìš©í•˜ê¸°</h3>
                <form method="post">
                    {% csrf_token %}
                    <input type="hidden" name="student_id" value="{{ student_id }}">
                    <input type="hidden" name="is_filtering" value="true">

                    <div class="filter-container">
                        <div class="filter-group">
                            <strong>ğŸ“š ê³¼ëª© ë¶„ë¥˜</strong>
                            <div class="filter-options">
                                <label><input type="checkbox" name="subject_category" value="ì „ê³µ"> ì „ê³µ</label>
                                <label><input type="checkbox" name="subject_category" value="êµì–‘"> êµì–‘</label>
                                <label><input type="checkbox" name="subject_category" value="ê¸°íƒ€"> ê¸°íƒ€</label>
                            </div>
                        </div>

                        <div class="filter-group">
                            <strong>ğŸ“Š í•™ì </strong>
                            <div class="filter-options">
                                {% for c in filter_options.credit %}
                                <label><input type="checkbox" name="credit" value="{{ c }}"> {{ c }}í•™ì </label>
                                {% endfor %}
                            </div>
                        </div>

                        <div class="filter-group">
                            <strong>ğŸ“… ì„ í˜¸ ìš”ì¼</strong>
                            <div class="filter-options">
                                {% for day in filter_options.days %}
                                <label><input type="checkbox" name="preferred_days" value="{{ day }}"> {{ day }}</label>
                                {% endfor %}
                            </div>
                        </div>

                        <div class="filter-group">
                            <strong>ğŸ• ì„ í˜¸ êµì‹œ</strong>
                            <div class="filter-options">
                                {% for period in filter_options.periods %}
                                <label><input type="checkbox" name="preferred_periods" value="{{ period }}"> {{ period
                                    }}êµì‹œ</label>
                                {% endfor %}
                            </div>
                        </div>

                        <div class="filter-group">
                            <strong>ğŸ¯ ìˆ˜ì—… ë°©ì‹</strong>
                            <div class="filter-options">
                                {% for item in filter_options.class_style %}
                                <label><input type="checkbox" name="class_styles" value="{{ item }}"> {{ item }}</label>
                                {% endfor %}
                            </div>
                        </div>

                        <div class="filter-group">
                            <strong>ğŸ“ í‰ê°€ ë°©ì‹</strong>
                            <div class="filter-options">
                                <label><input type="checkbox" name="grade_evaluation" value="ìƒëŒ€í‰ê°€"> ìƒëŒ€í‰ê°€</label>
                                <label><input type="checkbox" name="grade_evaluation" value="ì ˆëŒ€í‰ê°€"> ì ˆëŒ€í‰ê°€</label>
                                <label><input type="checkbox" name="grade_evaluation" value="P/F"> P/F</label>
                            </div>
                        </div>

                        <div class="filter-group">
                            <strong>âœï¸ ì„±ì  í‰ê°€ ë°©ì‹</strong>
                            <div class="filter-options">
                                {% for item in filter_options.grade_eval_methods %}
                                <label><input type="checkbox" name="grade_eval_methods" value="{{ item }}"> {{ item
                                    }}</label>
                                {% endfor %}
                            </div>
                        </div>

                        <div class="filter-group">
                            <strong>ğŸ“ ê°•ì˜ ë°©ì‹</strong>
                            <div class="filter-options">
                                {% for item in filter_options.lecture_methods %}
                                <label><input type="checkbox" name="lecture_methods" value="{{ item }}"> {{ item
                                    }}</label>
                                {% endfor %}
                            </div>
                        </div>
                    </div>

                    <button type="submit">í•„í„° ì ìš©í•˜ê¸°</button>
                </form>
            </div>

            {% if filtered_recommendations is not None %}
            <hr style="margin: 2em 0;">
            <h3>âœ… í•„í„° ì ìš© ê²°ê³¼ ({{ filtered_recommendations|length }}ê°œ)</h3>
            {% if filtered_recommendations %}
            <table>
                <thead>
                    <tr>
                        <th>ê³¼ëª©ëª…</th>
                        <th>í•™ì •ë²ˆí˜¸</th>
                        <th>ë¶„ë°˜</th>
                        <th>ê³¼ëª© ë¶„ë¥˜</th>
                        <th>ê³¼ëª© ì„¸ë¶€ë¶„ë¥˜</th>
                        <th>ê°œì„¤ ì‹œê°„</th>
                        <th>ì¶”ì²œ ì ìˆ˜</th>
                    </tr>
                </thead>
                <tbody>
                    {% for course in filtered_recommendations %}
                    <tr>
                        <td>{{ course.SUBJT_NM }}</td>
                        <td>{{ course.SUBJTNB }}</td>
                        <td>{{ course.CORSE_DVCLS_NO }}</td>
                        <td>{{ course.subject_category }}</td>
                        <td>{{ course.subject_div }}</td>
                        <td>{{ course.schedule_pairs }}</td>
                        <td>{{ course.pred_score|floatformat:3 }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            {% else %}
            <p>ì¡°ê±´ì— ë§ëŠ” ê³¼ëª©ì´ ì—†ìŠµë‹ˆë‹¤. í•„í„°ë¥¼ ì¡°ì •í•´ë³´ì„¸ìš”.</p>
            {% endif %}
            {% endif %}
        </div>
        {% endif %}
    </div>
</body>

</html>